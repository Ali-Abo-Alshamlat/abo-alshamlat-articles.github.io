<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../css/Font.css">
        <link rel="stylesheet" href="css/code.css">
        <link rel="stylesheet" href="../../css/prism.css">
        <script src="../../js/prism.js"></script>
        <script src="js/copycode.js"></script>
        <script type="module"
            src="https://unpkg.com/@deckdeckgo/highlight-code@latest/dist/deckdeckgo-highlight-code/deckdeckgo-highlight-code.esm.js"></script>
    </head>
    <body>
        
            <h1>
                SQL Injection IDS using snort
            </h1>
            Sql Injection also known as SQLi is a type of application attack that falls under injection attacks in the OWASP TOP 10 vulnerabilities list.It basically involves a user trying to pass in arguments/input that will alter with the final query that will be executed on the database.

            Other types of injection attacks are:

            Code injection
            <h3>
                IDS(Intrusion Detection System) — is a system that is used to monitor anormallies in a network and give notifiaction when it detects such. This helps the security personel to identify any suspicious activity and act accordingly. For there to be efficiency in the same, an IPS(Intrusion Prevention System) is integrated into the network. The advantage of IPS is that it not only gives alerts when in detects abnormal activity but it can also be configured based on certain policy to perform some action on behalf of the security personel.

                In this part we will set a simple IDS that will be used to monitor and alert against any type of sql injection attack, i.e. Manually or by use a tools to automate the process.

                To accomplish this, we will make use of snort, which is an open-source Network Intrusion Detection System(NIDS). More on snort:
            </h3>

            <pre>
                To begin with we require 3 machines…

                1-the attacking machine (kali linux).
                2-the machine which will host snort(ubuntu).
                3-the machine with the web application we will be attacking(metasploitable web server).
                  For this activity, I have installed the three machines on a virtual environment (VMware). feel free to use any hypervisor of your choice e.g virtual box e.t.c
            </pre>

            <h2>Procedure:</h2>

            <h2>Step 1: Installation of snort</h2>

            <pre>
                We will begin by checking whether snort is installed and if 
                it’s not ensure you install the latest version. check the version 
                by typing the following command in the machine you have installed snort (ubuntu machine).
                The command below can be used to install snort.
            </pre>


            <div class="container">
                <deckgo-highlight-code id="codeToCopy">
                    <code slot="code">
                    sudo apt install snort
            </code></deckgo-highlight-code>
            <button id="copyButton">Copy</button>
            </div>

            <pre>
                <i>snort — — version</i> ….. the output on your machine may not be exactly.
            </pre>

            <img src="/public/images/Snort/snort-1.png"/>

            <h2>
                Step 2:Setting up Snort
            </h2>

            <pre>
                Upon downloading snort, it comes with already some preconfigured rules
                which are located in the location /etc/snort/snort.conf which can be
                accessed either throght the terminal or by GUI.

                To access using GUI ensure you download nautilus which you will run as root.

                sudo apt install nautilus → installing nautilus

                sudo nautilus → running nautilus.

                running the above commands will open a window.

            </pre>

            <img src="/public/images/Snort/snort-2.png"/>

            <pre>
                click on other locations, then click on computer, after which it will display a
                list of directories. locate etc directory and open it, after which you locate
                another directory called snort. open the directory and it should contain
                contents similar to the ones

            </pre>
            <img src="/public/images/Snort/snort-3.png"/>

            <pre>
                NOTE: Before proceeding to make any changes, make a copy of the snort.conf file.
                You will have another added file by the name snort(copy).conf as seen above. The
                puporse of the extra copy is to act as a back up file that one can use in the scenario
                you mess up with the original copy.

            </pre>

            <h2>
                Step 2 a):Setting the Network address
            </h2>

            <pre>
                After successfully completing the above, open the snort.conf file and locate
                a line with the statement “Step #1:Set the network variables” and navigate to
                the line written ipvar HOME_NET any , edit the line by replacing the word
                any with the network address with which you want snort to caputure traffic.
                The final result should appear as shown in figure 2.3 below:

            </pre>

            <img src="/public/images/Snort/snort-4.png"/>

            After successfully doing this, save the changes made and exit.

            <h2>
                Step 2 b):Validation of configuration
            </h2>

            <pre>
                Navigate to a new terminal and type the following command as root user:

                <code>
                    snort -T -c /etc/snort/snort.conf
                </code>

                The command will be used to validate the configurations. the output should

            </pre>

            <img src="/public/images/Snort/snort-5.png"/>

            After running the above command

            <img src="/public/images/Snort/snort-7.png"/>

            this shows that snort has validate the configurations that we have made.

            <h2>
                Step 2 c:Starting snort
            </h2>

            <pre>
                Testing. We will now set up snort to listen for any traffic and it will give
                alerts according to the already preconfigured rules.

                on a new terminal, type the following command to start snort:

                <b>
                    <code>
                        sudo snort -A console -q -c /etc/snort/snort.conf -i ens33
                    </code>
                </b>


            </pre>

            <h2>
                Step 3:Testing
            </h2>

            <pre>
                navigate to the attacking machine (kali Linux) and try to perform an basic
                nmap scan to the machine with snort. The output should look close to the

            </pre>

            <img src="/public/images/Snort/snort-8.png"/>

            <h2>
                Step 4: Configuration of custom rules on snort.
            </h2>

            <pre>
                To configure custome rules, use the method used to access the snort.conf file but
                now in this case instead of using snort.conf file, open the directory by the
                name rules …it is in the same location as snort.conf file
                Locate the file indicated local.rules and open it. This is where we are going
                to add our own custom rules.


            </pre>

            <h2>
                Step 5: Performing Sql Injection Attack
            </h2>

            <pre>
                In this section, ensure your metasploitable web server is running. get it ip
                address and paste it to the kali machine on a browser, then access the
                mutillidae web application.

            </pre>

            <img src="/public/images/Snort/snort-9.png"/>

            <img src="/public/images/Snort/snort-10.png"/>

            <pre>
                After this, access the lab on SQLi-Extact Data by navigating to OWASP Top 10,
                select A1 Injection, SQLi-Extract Data, User info.


            </pre>

            <img src="/public/images/Snort/snort-11.png"/>

            <pre>
                We will begin by testing whether snort will detect manual injection attack.
                To do this ensure that snort is running then navigate to the above page and
                try to type any sql payload in the name and password fields and check the
                alert that snort will give.

                In this case a simple payload like ‘ OR ‘1’=’1 — — in both the input fields.
            </pre>

            <img src="/public/images/Snort/snort-12.png"/>

            <pre>
                by clicking View Account Details , and then snort generates some alerts
                based on the custom rules
            </pre>

            <img src="/public/images/Snort/snort-13.png"/>

            <pre>
                try another payload like using the union key word…

                Payload ‘UNION SELECT NULL,NULL,NULL,NULL,NULL,NULL,NULL 
                — — (apply to both input fields.)

                from the above snort generated more alerts

                check to see you can see the alerts from the custom rules you added


            </pre>

            <img src="/public/images/Snort/snort-14.png"/>

            <pre>
                We have successfully created a simple IDS to detect sql injection.

                
            </pre>


        <h2><i>
            flag{s1mple_linux_101}
        </i></h2>
    </body>
</html>