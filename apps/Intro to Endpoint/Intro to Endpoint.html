<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../css/Font.css">
        <link rel="stylesheet" href="css/code.css">
    </head>
    <body>

        <pre>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-1.png"/>

            Learn about fundamentals, methodology, and tooling for endpoint security monitoring.

            <h1>
                Task 1 Room Introduction
            </h1>

            In this room, we will introduce the fundamentals of endpoint security
            monitoring, essential tools, and high-level methodology. This room gives an
            overview of determining a malicious activity from an endpoint and mapping 
            its related events.

            To start with, we will tackle the following topics to build a stepping stone on
            how to deal with Endpoint Security Monitoring.

            Endpoint Security Fundamentals
            Endpoint Logging and Monitoring
            Endpoint Log Analysis

            At the end of this room, we will have a threat simulation wherein you need to
            investigate and remediate the infected machines. This activity may require
            you first to understand the fundamentals of endpoint security monitoring to
            complete it.

            Now, let’s deep-dive into the basics of Endpoint Security!

            <h1>
                Task 2 Endpoint Security Fundamentals
            </h1>

            <b>
                Core Windows Processes
            </b>

            Before we deal with learning how to deep-dive into endpoint logs, we need
            first to learn the fundamentals of how the Windows Operating System works.
            Without prior knowledge, differentiating an outlier from a haystack of
            events could be problematic.


            Task Manager is a built-in GUI-based Windows utility that allows users to see
            what is running on the Windows system. It also provides information on
            resource usage, such as how much each process utilizes CPU and memory.
            When a program is not responding, the Task Manager is used to terminate 
            the process.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-2.png"/>

            A Task Manager provides some of the Core Windows Processes running in
            the background. Below is a summary of running processes that are
            considered normal behaviour.

            Note: “>” symbol represents a parent-child relationship. 

            <code>
                System (Parent) > smss.exe (Child)
            </code>

            System
            System > smss.exe
            csrss.exe
            wininit.exe
            wininit.exe > services.exe
            wininit.exe > services.exe > svchost.exe
            lsass.exe
            winlogon.exe
            explorer.exe

            <b>
                Sysinternals
            </b>

            With the prior knowledge of Core Windows Processes, 
            we can now proceed to discuss the available toolset 
            for analyzing running artifacts in the backend of a Windows machine.

            File and Disk Utilities
            Networking Utilities
            Process Utilities
            Security Utilities
            System Information
            Miscellaneous

            TCPView — Networking Utility tool.
            Process Explorer — Process Utility tool.

            <b>
                TCPView
            </b>

            “TCPView is a Windows program that will show you detailed listings of all
            TCP and UDP endpoints on your system, including the local and remote
            addresses and state of TCP connections. On Windows Server 2008, Vista, and
            XP, TCPView.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-3.png"/>

            As shown above, every connection initiated by a process is listed by the tool,
            which may aid in correlating the network events executed concurrently.

            <h1>
                Process Explorer
            </h1>

            “The Process Explorer display consists of two sub-windows.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-4.png"/>

            Process Explorer enables you to inspect the details of a running process, such as:

            Associated services
            Invoked network traffic
            Handles such as files or directories opened
            DLLs and memory-mapped files loaded

            <b>
                Answer the questions below
            </b>

            Since the answers can be found above, I won’t share the actual answer below.

            <b>
                What is the normal parent process of services.exe?
            </b>

            The answer can be found under the TaskManager section above. Look for Note:,

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-5.png"/>

            <b>
                What is the name of the network utility tool introduced in this task?
            </b>

            This answer first appears in the Sysinternals section. 
            But then the section afterwards is all about this tool.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-6.png"/>

            <b>
                Task 3 Endpoint Logging and Monitoring
            </b>

            Windows Event Logs

            The Windows Event Logs are not text files that can be viewed using a text editor. 
            The log files with the .evtx file extension
            typically reside in C:\Windows\System32\winevt\Logs.

            There are three main ways of accessing these event logs within a Windows
            system:

            Event Viewer (GUI-based application)
            Wevtutil.exe (command-line tool)
            Get-WinEvent (PowerShell cmdlet)

            An example image of logs viewed using the Event Viewer tool is shown below.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-7.png"/>

            The image below shows a sample set of Sysmon logs viewed using an Event Viewer.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-8.png"/>

            <b>
                OSQuery
            </b>

            Osquery is an open-source tool created by Facebook.
            To interact with the Osquery interactive console/shell, open CMD (or
            PowerShell) and run osqueryi. You'll know that you've successfully entered
            into the interactive shell by the new command prompt.

            <code>
                cmd.exe

                C:\Users\Administrator\> osqueryi
                Using a virtual database. Need help, type 'help'
                osquery>
            </code>

            A sample use case for using OSQuery is to list important process information
            by its process name.

            <code>
                osqueryi

                osquery> select pid,name,path from processes where name='lsass.exe';
                +-----+-----------+-------------------------------+
                | pid | name      | path                          |
                +-----+-----------+-------------------------------+
                | 748 | lsass.exe | C:\Windows\System32\lsass.exe |
                +-----+-----------+-------------------------------+
                osquery>
            </code>

            Osquery only allows you to query events inside the machine.

            <b>
                Wazuh
            </b>

            Wazuh is an open-source, freely available, and extensive EDR solution,
            which Security Engineers can deploy in all scales of environments.

            A sample view of how Wazuh works is shown below.

            <img class="gif" src="/public/images/Intro to Endpoint/Intro to Endpoint-9.gif"/>

            <b>
                Answer the questions below
            </b>

            Since the answers can be found above, I won’t share the actual
            answer below. Just where you can find them.

            <b>
                Where do the Windows Event logs (.evtx files) typically reside?
            </b>

            The answer can be found in the Windows Event Logs section.
            You will find an absolute path that ends with \Logs. Once you
            find the path, copy and paste it in the TryHackMe answer field, 
            then click Submit.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-10.png"/>

            <b>
                Provide the command used to enter OSQuery CLI.
            </b>

            Looking under the OSQuery section, you will see a sentence that
            explains the command needed to start OSQuery on the
            commandline. Once you find the command, copy and paste it
            into the TryHackMe answer field, then click Submit.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-12.png"/>

            <b>
                What does EDR mean? Provide the answer in lowercase.
            </b>

            Looking at the Wazuh section, you will see the acronymn EDR several times.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-13.png"/>

            <b>
                Task 4 Endpoint Log Analysis
            </b>

            Event Correlation

            Event correlation identifies significant relationships from
            multiple log sources such as application logs, endpoint logs,
            and network logs.

            Source and Destination IP
            Source and Destination Port
            Action Taken
            Protocol
            Process name
            User Account
            Machine Name

            <i>
                Baselining
            </i>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-14.png"/>

            <b>
                Answer the questions below
            </b>

            Click on the green View Site button in this task to open the Static Site
            Lab and start investigating the threat by following the provided
            instructions.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-15.png"/>

            <b>
                Provide the flag for the simulated investigation activity.
            </b>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-16.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-17.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-18.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-19.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-20.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-21.png"/>

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-22.png"/>

            Now we can click on flag.txt, to open the file and get the flag.

            <img src="/public/images/Intro to Endpoint/Intro to Endpoint-23.png"/>

            <h2>
                Answer: THM{3ndp01nt_s3cur1ty!}
            </h2>

            <h1>
                Task 5 Conclusion
            </h1>

            Congratulations! You have completed the investigation task.

            In the simulated threat investigation activity, we have learned the following:

            In conclusion, we covered the basic concepts of Endpoint Security Monitoring:

            <b>
                Endpoint Security Fundamentals
            </b>
            tackled Core Windows Processes and Sysinternals.

            <b>
                Endpoint Logging and Monitoring
            </b>

            introduced logging functionalities such as Windows Event Logging and Sysmon
            and monitoring/investigation tools such as OSQuery and Wazuh.

            <b>
                Endpoint Log Analysis 
            </b>

            highlighted the importance of having a methodology such as baselining and event correlation.

            
        </pre>
    </body>