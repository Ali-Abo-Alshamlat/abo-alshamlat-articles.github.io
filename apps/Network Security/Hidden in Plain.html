<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../css/Font.css">
        <link rel="stylesheet" href="css/code.css">
        <script src="js/folderview.js"></script>
    </head>
    <body>
        <pre>
            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-1.png"/>

            <h3>Step 1: </h3>

            After downloading the zip file and extracting it. we will find three pcap files and analysing them by
            using wireshark tool.

            First thing, let’s check what procotols do they have via Statistics > Protocol Hierarchy

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-2.png"/>

            <h3>Step 2: </h3>

            Now, we can proceed with our analysis. Looking at the packets and we only observe the interesting
            thing is about the ICMP data.

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-3.png"/>

            <h3>Step 3: </h3>

            It’s the time to extract the icmp data from the packets using tshark or pyshark tools.

            I have written a small script using pyshark to extract the icmp data.

            <div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!" title=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">
                1
                2
                3
                4
                5
                6
                7
                8
                9
                10
                11
                12
                13
                14
                15
                16
                17
                18
                19
                20
                21
                22
                23
                24
                25
                26
                </pre></td><td class="rouge-code"><pre>
                <span class="kn">import</span> <span class="nn">pyshark</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                
                <span class="c1"># stores pcap filename
                </span><span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="c1"># open pcap file
                </span><span class="nb">file</span> <span class="o">=</span> <span class="n">pyshark</span><span class="p">.</span><span class="n">FileCapture</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                
                <span class="c1"># loop over each packet
                </span><span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
                
                    <span class="c1"># fetch icmp data from packet as "57:00:..."
                </span>    <span class="n">cap</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">.</span><span class="n">icmp</span><span class="p">.</span><span class="n">data_data</span>
                
                    <span class="c1"># insert the fetched data into a list
                </span>    <span class="n">data_list</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span>
                
                    <span class="c1">#  storing the offset bytes in one string after converting it from hex to char
                </span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="s">""</span>
                
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">))</span>
                
                    <span class="k">print</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>   
                </pre></td></tr></tbody></table></code></div></div>

            After running the script, we will see the icmp data combined with strange symbols.
            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-4.png"/>

            <h3>Step 4:</h3>

            There was nothing clear after extracting the icmp data. I stopped at this point then contacted
            the technical team for providing any hints for the challenge.

            <h3>Hint: yEnc Encrypted and the flag format is a hash</h3>

            I have searched for how it works and how to use it in python. Actually, I have found a yEnc
            module for python and it supports the encoding/decoding directly to files or memory buffers.

            At this time, I have modified the script in order to implement the decode operation on the
            extracted icmp data to see what will be the results.

            <div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!" data-original-title="" title=""><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">
                1
                2
                3
                4
                5
                6
                7
                8
                9
                10
                11
                12
                13
                14
                15
                16
                17
                18
                19
                20
                21
                22
                23
                24
                25
                26
                27
                28
                29
                30
                31
                32
                33
                34
                35
                36
                37
                38
                </pre></td><td class="rouge-code"><pre>
                <span class="kn">import</span> <span class="nn">pyshark</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                <span class="kn">import</span> <span class="nn">yenc</span>
                
                <span class="c1"># stores pcap filename
                </span><span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="c1"># open pcap file
                </span><span class="nb">file</span> <span class="o">=</span> <span class="n">pyshark</span><span class="p">.</span><span class="n">FileCapture</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                
                <span class="c1"># loop over each packet
                </span><span class="k">for</span> <span class="n">pkt</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
                
                    <span class="c1"># fetch icmp data from packet as "57:00:..."
                </span>    <span class="n">cap</span> <span class="o">=</span> <span class="n">pkt</span><span class="p">.</span><span class="n">icmp</span><span class="p">.</span><span class="n">data_data</span>
                
                    <span class="c1"># insert the fetched data into a list
                </span>    <span class="n">data_list</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span>
                
                    <span class="c1">#  storing the offset bytes in one string after converting it from hex to char
                </span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="s">""</span>
                
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">))</span>
                
                    <span class="c1"># storing the encoding yenc icmp data into an input file
                </span>
                    <span class="n">inputFile</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inputFile</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"latin-1"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
                
                    <span class="c1"># decoding yenc icmp data to an output file
                </span>
                    <span class="n">outputFile</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                   
                    <span class="n">yenc</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">inputFile</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>
                </pre></td></tr></tbody></table></code></div></div>

                <h3>Step 5:</h3>
                Executing the script by giving it the following arguments:

                pcap file name
                input file to store the yenc encoded data
                output file to decode the yenc encoded data

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-5.png"/>

            When running the script on the first pcap file f101.pcap, I found something that might be
            interested from the decode operation.

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-6.png"/>

            <h3>Step 6:</h3>

            I have copied and inserted this data on CyberChef then found that this is a base64 encoding,
            after decoding it we observe the output result.

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-7.png"/>

            We still need to perform another operation in order to get the flag. 
            So let’s get the md5 hash of the “flag” word.

            <img src="/public/images/Network Security/Hidden in Plain/Hidden In Plain-8.png"/>
            

        </pre>
        <h2><i>
            flag{327a6c4304ad5938eaf0efb6cc3e53dc}
        </i></h2>
    </body>
</html>