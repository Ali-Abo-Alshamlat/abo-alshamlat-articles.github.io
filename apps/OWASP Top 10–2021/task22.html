<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../../css/Font.css">
        <link rel="stylesheet" href="css/code.css">
    </head>
    <body>
        <pre>

            <h1>
            Server-Side Request Forgery (SSRF)
            </h1>

            Start the machine and the attack box, then open Firefox. Head to the given
            site, http://MACHINE_IP:8087/.

            The first question asks for the host that is allowed in the Admin Area. to find
            this answer we need to navigate to that page. Look for the three bars in the
            upper right and click on it.

            <img src="../../public/images/OWASP Top 10–2021/task22-1.png"/>

            Now attempt to open the Admin Area.

            <img src="../../public/images/OWASP Top 10–2021/task22-2.png"/>

            Once you attempt, you will be given a message that you were denied access,
            because you are not the “localhost”. This is the answer to the first question.

            <img src="../../public/images/OWASP Top 10–2021/task22-3.png"/>

            The next question asks for the server parameter for the resume download.
            Go back to the home page. Hover your pointer over the bottom.

            <img src="../../public/images/OWASP Top 10–2021/task22-4.png"/>

            Or alternatively, you can right-click and inspect the button.

            <img src="../../public/images/OWASP Top 10–2021/task22-5.png"/>

            Either way, you will notice server=. “secure-file-storgage.com” is the answer
            that we are looking for.

            The next question asks us to intercept the request via SSRF.

            We are going to the link which should be similar to this:

            <blockquote>
                http://10.10.182.198:8087/download?server=secure-file-storage.com:8087&id=75482342
            </blockquote>

            The next step is to remove and replace it with the IP of your attack box.

            Open your terminal and use the command (this is for netcat listener):

            <blockquote>
                nc -lvnp 8087
            </blockquote>

            Once netcat listener is open, use the altered link. Keep an eye on the
            terminal to get the flag.

            <img src="../../public/images/OWASP Top 10–2021/task22-6.png"/>

            EXTRA CREDIT (BECAUSE WHY NOT)

            note: You don’t have to grab this flag to finish the room, feel free to skip this,
            or continue on for your own information.

            We are going to work on the server’s link to get into the Admin Area

            <blockquote>
                http://10.10.182.198:8087/download?server=secure-file-storage.com:8087&id=75482342
            </blockquote>

            I figured out that you can use a method similar to SQL injection to break up 
            the server and id in the link (obfuscation). 
            Some forums called it “escaping the # (hash)”. 

            <blockquote>
                server=http://localhost:8087/admin%23&id=75482342
            </blockquote>

            Take this and insert it into the URL to get this:

            <blockquote>
                http://10.10.190.86:8087/download?server=http://localhost:8087/admin%23&id=75482342
            </blockquote>

            You should get the flag and feel a sense of accomplishment, because you
            completed an optional task that required research and persistence.

            <img src="../../public/images/OWASP Top 10–2021/task22-7.png"/>

            Explore the website. What is the only host allowed to access the admin area?
            Answer Format: *********

            Hint: Try to access the admin area. Can you find any useful info in the error
            messages?

            <h2>
                Answer: localhost
            </h2>

            Check the “Download Resume” button. Where does the server parameter
            point to? Answer Format: ***********************

            <h2>
                Answer: secure-file-storage.com
            </h2>

            Using SSRF, make the application send the request to your AttackBox instead
            of the secure file storage. Are there any API keys in the intercepted request?
            Answer Format: ***{************************}

            <h2>
                Answer: THM{Hello_Im_just_an_API_key}
            </h2>

            Going the Extra Mile: There’s a way to use SSRF to gain access to the site’s
            admin area. Can you find it?

            Note: You won’t need this flag to progress in the room. You are expected to
            do some research in order to achieve your goal.

            Mark as Completed
        </pre>
    </body>